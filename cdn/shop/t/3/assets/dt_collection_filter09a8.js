const debounce=(func,delay)=>{let debounceTimer;return function(){const context=this,args=arguments;clearTimeout(debounceTimer),debounceTimer=setTimeout(()=>func.apply(context,args),delay)}};class CollectionFiltersForm extends HTMLElement{constructor(){super(),this.filterData=[],this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=debounce(event=>{event.preventDefault(),this.onSubmitHandler(event)},0),document.querySelector("#CollectionFiltersForm").addEventListener("submit",this.onSubmitHandler),window.addEventListener("popstate",this.onHistoryChange.bind(this)),this.bindActiveFacetButtonEvents()}onSubmitHandler(event){event.preventDefault();const formAction=event.target.closest("form").action,formData=new FormData(event.target.closest("form")),searchParams=new URLSearchParams(formData).toString();dTRenderCollection(formAction,searchParams,event)}onActiveFilterClick(event){event.preventDefault(),this.toggleActiveFacets();const targetURL=event.target.href;this.renderPage(targetURL,new URL(event.target.href).searchParams.toString())}onHistoryChange(event){const searchParams=event.state?.searchParams||"",targetURL=event.target.href;this.renderPage(targetURL,searchParams,null,!1)}bindActiveFacetButtonEvents(){document.querySelectorAll(".js-facet-remove").forEach(element=>{element.addEventListener("click",this.onActiveFilterClick,{once:!1})})}toggleActiveFacets(disable=!0){}renderPage(targetURL,searchParams,event,updateURLHash=!0){const sections=[1];document.querySelector(".collection-grid").querySelector("#dT_collectionGrid").classList.add("loading"),targetURL=targetURL.split("?"),targetURL=targetURL[0].trim()+"?",sections.forEach(section=>{const url=`${targetURL}&${searchParams}`,filterDataUrl=element=>element.url===url;this.filterData.some(filterDataUrl)?this.renderSectionFromCache(filterDataUrl,section,event):this.renderSectionFromFetch(url,section,event)}),updateURLHash&&this.updateURLHash(searchParams)}renderSectionFromFetch(url,section,event){fetch(url).then(response=>response.text()).then(responseText=>{const html=responseText;this.filterData=[...this.filterData,{html,url}],this.renderFilters(html,event),this.renderProductGrid(html)})}renderSectionFromCache(filterDataUrl,section,event){const html=this.filterData.find(filterDataUrl).html;this.renderFilters(html,event),this.renderProductGrid(html)}renderProductGrid(html){var getCollectionListClass=function(){return document.querySelector("#dT_collectionGrid >ul:first-child").getAttribute("class")}();const innerHTML=new DOMParser().parseFromString(html,"text/html").getElementById("dT_collectionGrid").innerHTML;document.getElementById("dT_collectionGrid").innerHTML=innerHTML,document.querySelector("#dT_collectionGrid >ul:first-child").setAttribute("class",getCollectionListClass),this.postInit()}renderFilters(html,event){const innerHTML=new DOMParser().parseFromString(html,"text/html").getElementById("dt-collection-filter").innerHTML;document.getElementById("dt-collection-filter").innerHTML=innerHTML}updateURLHash(searchParams){history.pushState({searchParams},"",`${window.location.pathname}${searchParams&&"?".concat(searchParams)}`)}renderCounts(source,target){[".count-bubble",".facets__selected"].forEach(selector=>{const targetElement=target.querySelector(selector);source.querySelector(selector)&&targetElement&&(target.querySelector(selector).outerHTML=source.querySelector(selector).outerHTML)})}postInit(){document.querySelector(".collection-grid").querySelector("#dT_collectionGrid").classList.remove("loading"),this.bindActiveFacetButtonEvents(),this.toggleActiveFacets(!1),typeof collectionFilterPostInit=="function"&&collectionFilterPostInit()}}const dTRenderCollection=function(targetURL,searchParams,event){new CollectionFiltersForm().renderPage(targetURL,searchParams,event)};customElements.define("collection-filters-form",CollectionFiltersForm);
//# sourceMappingURL=/cdn/shop/t/3/assets/dt_collection_filter.js.map?v=10951606678138750431631609047
